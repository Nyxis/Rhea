<?xml version="1.0" encoding="UTF-8"?>
<database defaultIdMethod="native" name="default" namespace="EasyTask\Bundle\WorkflowBundle\Model\Workflow">

    <table name="workflow">
        <column name="id" type="INTEGER" primaryKey="true" required="true" autoIncrement="true" description="id, primary key" />
        <column name="type" type="VARCHAR" required="true" description="type of the task" />
        <column name="title" type="VARCHAR" required="true" description="workflow title" />
        <column name="description" type="LONGVARCHAR" required="false" description="workflow description" />
        <column name="created_by" type="INTEGER" required="true" description="user fk" />
        <behavior name="timestampable" />
        <index>
            <index-column name="type"/>
        </index>

        <foreign-key foreignTable="internal" skipSql="true">
            <reference local="created_by" foreign="id"/>
        </foreign-key>
    </table>

    <table name="workflow_node">
        <column name="id" type="INTEGER" primaryKey="true" required="true" autoIncrement="true" description="id, primary key" />
        <column name="workflow_id" type="INTEGER" required="true" description="workflow fk" />
        <column name="name" type="VARCHAR"  required="true" description="current state name" />
        <column name="assigned_to" type="INTEGER" required="true" description="user fk" />
        <column name="prev_id" type="VARCHAR"  required="false" description="prev state" />
        <column name="next_id" type="VARCHAR"  required="false" description="next state" />
        <column name="current" type="BOOLEAN" required="true" />

        <foreign-key foreignTable="workflow" skipSql="true">
            <reference local="workflow_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="workflow_node" skipSql="true">
            <reference local="prev_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="workflow_node" skipSql="true">
            <reference local="next_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="internal" skipSql="true">
            <reference local="assigned_to" foreign="id"/>
        </foreign-key>

        <behavior name="timestampable" />
    </table>

</database>
